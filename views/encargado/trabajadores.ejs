<%- include('../partials/header', { title: 'Gestionar Trabajadores' }) %>
<%- include('../partials/navbar') %>

<h1>Asignar Tareas a Trabajadores</h1>

<% if (typeof error !== 'undefined' && error) { %>
    <div class="alert alert-error"><%= error %></div>
<% } %>

<div class="form-section">
    <h2>Nueva Tarea</h2>
    <form method="POST" action="/encargado/asignar-tarea" class="form">
        <div class="form-group">
            <label for="trabajadorId">Trabajador:</label>
            <select id="trabajadorId" name="trabajadorId" required>
                <option value="">Seleccione un trabajador</option>
                <% if (typeof trabajadores !== 'undefined' && trabajadores && trabajadores.length > 0) { %>
                    <% trabajadores.forEach(trabajador => { %>
                        <option value="<%= trabajador.id %>"><%= trabajador.email %></option>
                    <% }); %>
                <% } else { %>
                    <option value="" disabled>No hay trabajadores disponibles. Crea uno desde el panel de usuarios.</option>
                <% } %>
            </select>
        </div>

        <div class="form-group">
            <label for="cabanaId">Cabaña (opcional):</label>
            <select id="cabanaId" name="cabanaId">
                <option value="">Ninguna</option>
                <% if (typeof cabanas !== 'undefined' && cabanas && cabanas.length > 0) { %>
                    <% cabanas.forEach(cabana => { %>
                        <option value="<%= cabana.id %>"><%= cabana.nombre %></option>
                    <% }); %>
                <% } %>
            </select>
        </div>

        <div class="form-group">
            <label for="preparacionId">Preparación (opcional):</label>
            <select id="preparacionId" name="preparacionId">
                <option value="">Ninguna</option>
                <% if (typeof preparaciones !== 'undefined' && preparaciones && preparaciones.length > 0) { %>
                    <% preparaciones.forEach(prep => { %>
                        <option value="<%= prep.id %>">Cabaña <%= prep.cabanaId %> - Reserva <%= prep.reservaId %></option>
                    <% }); %>
                <% } %>
            </select>
        </div>

        <div class="form-group">
            <label for="tipo">Tipo de Tarea:</label>
            <select id="tipo" name="tipo" required>
                <option value="limpieza">Limpieza</option>
                <option value="mantenimiento">Mantenimiento</option>
                <option value="inventario">Inventario</option>
                <option value="otro">Otro</option>
            </select>
        </div>

        <div class="form-group">
            <label for="descripcion">Descripción:</label>
            <textarea id="descripcion" name="descripcion" rows="3" required></textarea>
        </div>

        <div class="form-group">
            <label for="fechaAsignada">Fecha:</label>
            <input type="date" id="fechaAsignada" name="fechaAsignada" required>
        </div>

        <button type="submit" class="btn btn-primary">Asignar Tarea</button>
    </form>
</div>

<h2>Tareas Asignadas</h2>
<% if (typeof tareasPendientes !== 'undefined' && tareasPendientes && tareasPendientes.length > 0) { %>
<div class="table-container">
    <table>
        <thead>
            <tr>
                <th>Trabajador</th>
                <th>Tipo</th>
                <th>Descripción</th>
                <th>Fecha</th>
                <th>Estado</th>
            </tr>
        </thead>
        <tbody>
            <% tareasPendientes.forEach(tarea => { %>
            <tr>
                <td><%= tarea.trabajador ? tarea.trabajador.email : 'N/A' %></td>
                <td><%= tarea.tipo %></td>
                <td><%= tarea.descripcion %></td>
                <td><%= new Date(tarea.fechaAsignacion).toLocaleDateString() %></td>
                <td><span class="badge badge-<%= tarea.estado %>"><%= tarea.estado %></span></td>
            </tr>
            <% }); %>
        </tbody>
    </table>
</div>
<% } else { %>
    <p>No hay tareas asignadas aún. Las tareas que asignes aparecerán aquí.</p>
<% } %>

<%- include('../partials/footer') %>